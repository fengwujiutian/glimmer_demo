<meta charset="utf-8">
*Glimmer API 文档*  

**通用说明**  

+ uint64表示以16进制格式保存的无符号64位整数
+ 文本将以utf-8形式保存和传输
+ 所有api均在/api/下
+ api大小写敏感，谨慎操作
+ 原则上要求https，调试期间暂时不需要

**返回结果示例**

成功

	{
		"errNum" : 0,
		"message" : "success",
		"retData" :{
			"userToken" : "3=3rfFji9#ksFV=+ "
		}
	}
失败

	{
		"errNum" : 404,
		"message" : "failed"
	}

**错误信息一览**

 | 号码 | 名称 | 描述 | 
 | --- |:---:|:---:|
 | 0 | 成功 | 无 | 
 | 100 | 请求错误 | 用户请求的地址或格式错误 | 
 | 101 | 无效表单 | 用户发送的表单无效，有多出或错误的项目 | 
 | 200 | 拒绝访问 | 所需api不允许当前用户访问 | 
 | 201 | 凭据过期 | cookie已过期，需要重新登录 | 
 | 300 | 内容无效 | 请求内容是错误的或是不被支持的，如非法字符，不支持的文件，错误的用户名与密码 | 
 | 301 | 错误的用户名和密码 | 如果邮箱存在而密码错误会返回301特定情况下邮箱不存在时也会返回301 | 
 | 302 | 用户名不存在 | 服务器检测到大量尝试用户名的情况下会返回301 | 
 | 303 | 用户名已存在 | 注册时使用了已存在的用户名，检测到试探的情况下对所有该用户的请求返回400 | 
 | 304 | 表单内容类型错误 | 表单中的项目使用了错误的类型 | 
 | 305 | 表单内容错误 | 内容为不合法的值，错误的路径等，有攻击行为等 | 
 | 400 | 服务器错误 | 服务器出错，请稍后重试 | 

**账号相关 /api/account**

+ 密码摘要 = sha2(邮箱+ "glimmer"+ 密码)

 | 名称 | 方法 | url | 
 | --- |:---:|:---:|
 | 登录 | POST | /api/account/login | 
 | 注册 | POST | /api/account/register | 
 | 激活账号 | POST | /api/account/activate | 
 | 更改密码 | POST | /api/account/changePassword | 
 | 更改信息 | POST | /api/account/changeInformation | 
 | 查询信息 | POST | /api/account/info | 


***登录***

根据用户名和密码登录

 | 名称 | 参数名 | 类型 | 必填 | 描述 | 默认值 | 
 | --- |:---:|:---:|:---:|:---:|:---:|
 | 邮箱 | usermail | string | 是 | 用户邮箱，大小写不敏感 | null | 
 | 密码摘要 | password | uint64 | 是 | 用户密码，格式如上 | null | 


***注册***

根据用户名和密码注册

 | 名称 | 参数名 | 类型 | 必填 | 描述 | 默认值 | 
 | --- |:---:|:---:|:---:|:---:|:---:|
 | 邮箱 | usermail | string | 是 | 用户邮箱，大小写不敏感 | null | 
 | 密码摘要 | password | uint64 | 是 | 用户密码，格式如上 | null | 

***激活账号***

在邮件中的激活链接

 | 名称 | 参数名 | 类型 | 必填 | 描述 | 默认值 | 
 | --- |:---:|:---:|:---:|:---:|:---:|
 | 邮件凭据 | mailtoken | uint64 | 是 | 随注册邮件一同发送 | null | 

将用户重定向到个人信息修改页

***更改密码***

 | 名称 | 参数名 | 类型 | 必填 | 描述 | 默认值 | 
 | --- |:---:|:---:|:---:|:---:|:---:|
 | 旧密码摘要 | password | string | 是 | 用户密码，格式如上 | null | 
 | 新密码摘要 | password | string | 是 | 用户密码，格式如上 | null | 

***更改信息***

 | 名称 | 参数名 | 类型 | 必填 | 描述 | 默认值 | 
 | --- |:---:|:---:|:---:|:---:|:---:|
 | 昵称 | name | string | 否 | 用户的昵称 | null | 
 | 头像 | avatar | string | 否 | 用户的头像图片ID | null | 

不填写的情况下不会修改

***查询信息***

 | 名称 | 参数名 | 类型 | 必填 | 描述 | 默认值 | 
 | --- |:---:|:---:|:---:|:---:|:---:|
 | 用户ID | userid | uint64 | 否 | 被请求的用户id | null | 

不填写的情况下返回当前用户信息

 | 名称 | 项目名 | 类型 | 描述 | 
 | --- |:---:|:---:|:---:|
 | 用户ID | userid | uint64 | 被请求的用户id | 
 | 昵称 | name | string | 用户的昵称 | 
 | 头像 | avatar | string | 用户的头像id | 

 **内容上传  /api/upload/**


 | 名称 | 方法 | url | 
 | --- |:---:|:---:|
 | 图片 | POST | /api/upload/imgage |
 | 帖子 | POST | /api/upload/post |


***图片***

 | 名称 | 参数名 | 类型 | 必填 | 描述 | 默认值 | 
 | --- |:---:|:---:|:---:|:---:|:---:|
 | 图片 | image | 二进制 | 是 | 直接发送图片二进制 | null |


 | 名称 | 项目名 | 类型 | 描述 | 
 | --- |:---:|:---:|:---:|
 | 图片ID | imageid | string | 上传的图片获得的id | 



 ***帖子***

 | 名称 | 参数名 | 类型 | 必填 | 描述 | 默认值 | 
 | --- |:---:|:---:|:---:|:---:|:---:|
 | 图片ID | imageids | Array of string | 否 | 将所有图片ID按顺序排列 | null |
 | 标题 | title | string | 是 | 帖子的标题 | null |
 | 详细内容 | content | string | 否 | 帖子的内容 | null |

 注：以上是json内的内容，json要在一个叫post的key下面POST过来



 | 名称 | 项目名 | 类型 | 描述 | 
 | --- |:---:|:---:|:---:|
 | 帖子ID | postid | uint64 | 上传的帖子获得的id | 


 **帖子操作  /api/posts/**


 | 名称 | 方法 | url | 
 | --- |:---:|:---:|
 | 首页展览 | GET | /api/posts/exhibition |
 | 用户的帖子 | GET | /api/posts/my |
 | 获取帖子 | GET | /api/posts/getpost |
 | 获取评论 | GET | /api/posts/getcomment |
 | 删除帖子 | GET | /api/posts/delpost |

 ***首页展览***

 | 名称 | 参数名 | 类型 | 必填 | 描述 | 默认值 | 
 | --- |:---:|:---:|:---:|:---:|:---:|
 | 页码 | page | int | 否 | 请求的页码，每页不多于20条 | 0 |


 | 名称 | 项目名 | 类型 | 描述 | 
 | --- |:---:|:---:|:---:|
 | 帖子ID | postids | Array of uint64 | 获得的帖子id们 | 


 ***用户的帖子***

 未实现

 | 名称 | 参数名 | 类型 | 必填 | 描述 | 默认值 | 
 | --- |:---:|:---:|:---:|:---:|:---:|
 | 页码 | page | int | 否 | 请求的页码，每页不多于20条 | 0 |
 | 用户ID | userid | uint64 | 否 | 被请求的用户ID，空置请求当前用户 | null |


 | 名称 | 项目名 | 类型 | 描述 | 
 | --- |:---:|:---:|:---:|
 | 帖子ID | postids | Array of uint64 | 获得的帖子id们 | 

***获取帖子***
 | 名称 | 参数名 | 类型 | 必填 | 描述 | 默认值 | 
 | --- |:---:|:---:|:---:|:---:|:---:|
 | 帖子ID | postid | uint64 | 是 | 被请求的帖子ID | null |

 | 名称 | 项目名 | 类型 | 描述 |  
 | --- |:---:|:---:|:---:|:---:|:---:|
 | 图片ID | imageids | Array of uint64  | 将所有图片ID按顺序排列 |
 | 标题 | title | string  | 帖子的标题 | 
 | 详细内容 | content | string | 帖子的内容 | 
 | 评论数量 | commentCnt | uint64 | 帖子下评论的数目 |

***获取评论***
 | 名称 | 参数名 | 类型 | 必填 | 描述 | 默认值 | 
 | --- |:---:|:---:|:---:|:---:|:---:|
 | 帖子ID | postid | uint64 | 是 | 被请求的帖子ID | null |
 | 评论号 | commentid | uint64 | 是 | 被请求的评论编号 | null |

 注：评论从0到n-1编号

 | 名称 | 项目名 | 类型 | 描述 |  
 | --- |:---:|:---:|:---:|:---:|:---:|
 | 详细内容 | content | string | 评论的内容 | 

 ***删除帖子***
 | 名称 | 参数名 | 类型 | 必填 | 描述 | 默认值 | 
 | --- |:---:|:---:|:---:|:---:|:---:|
 | 帖子ID | postid | uint64 | 是 | 被请求的帖子ID | null |

结果参见返回值


 **图片操作  /api/image**


 | 名称 | 方法 | url | 
 | --- |:---:|:---:|
 | 获得图片 | GET | /api/image |


 ***获得图片***
 
 | 名称 | 参数名 | 类型 | 必填 | 描述 | 默认值 | 
 | --- |:---:|:---:|:---:|:---:|:---:|
 | 图片ID | imageid | uint64 | 是 | 被请求的图片ID | null |

会以二进制形式传输图片，或直接用http状态码表示错误

**管理员专用 /api/admin**


 | 名称 | 方法 | url | 
 | --- |:---:|:---:|
 | serverLog | GET | /api/serverlog |
 | dbLog | GET | /api/dbLog |

 需要管理员权限，直接请求返回相应log file